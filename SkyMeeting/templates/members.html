{% extends 'base.html'%}

{%block title%}SkyMeeting{%endblock%}

{%block cssfile%}
<!-- others -->
<link href="../public/css/uniform.default.css" rel="stylesheet">
<link href="../public/css/chosen.css" rel="stylesheet">

<style type="text/css">
	/*common*/
	.pagination-row {		
		text-align: center;
	}
	.pagination-row .pagination {
		margin: 5px 0;
	}
	.new-item-row {
		margin-top: 15px;
	}
	a.tag{
		padding: 0 7px;
		margin-bottom: 5px;
		height: 22px;
		line-height: 22px;
		display: inline-block;
		background: #f1f1f1;
		text-align: center;
		color: #999;
		text-decoration: none;
		cursor: pointer;
		border: 1px solid #ccc;
		-webkit-border-radius: 3px;
		-moz-border-radius: 3px;
		border-radius: 3px;
	}
	a.tag:link, a.tag:hover{
		/*background: #84bce2;
		color: #fff;*/
	}
	a.tag-selected{
		background: #0088cc;
		color: #fff;
	}
	/*patch*/
	.checkbox{
		padding-left: 0;
	}
	.checkbox.inline{
		margin-right: 15px;
	}

	/*copied from bootcss.com*/
	.side-nav {
	  /*width: 265px;*/
	  margin: 0;
	  padding: 0;
	  background-color: #fff;
	  -webkit-border-radius: 6px;
	     -moz-border-radius: 6px;
	          border-radius: 6px;
	  -webkit-box-shadow: 0 1px 4px rgba(0,0,0,.065);
	     -moz-box-shadow: 0 1px 4px rgba(0,0,0,.065);
	          box-shadow: 0 1px 4px rgba(0,0,0,.065);
	}
	.side-nav > li > a {
	  display: block;
	  width: 190px \9;
	  margin: 0 0 -1px;
	  padding: 8px 14px;
	  border: 1px solid #e5e5e5;
	}
	.side-nav > li:first-child > a {
	  -webkit-border-radius: 6px 6px 0 0;
	     -moz-border-radius: 6px 6px 0 0;
	          border-radius: 6px 6px 0 0;
	}
	.side-nav > li:last-child > a {
	  -webkit-border-radius: 0 0 6px 6px;
	     -moz-border-radius: 0 0 6px 6px;
	          border-radius: 0 0 6px 6px;
	}
	.side-nav > .active > a {
	  position: relative;
	  z-index: 2;
	  padding: 9px 15px;
	  border: 0;
	  text-shadow: 0 1px 0 rgba(0,0,0,.15);
	  -webkit-box-shadow: inset 1px 0 0 rgba(0,0,0,.1), inset -1px 0 0 rgba(0,0,0,.1);
	     -moz-box-shadow: inset 1px 0 0 rgba(0,0,0,.1), inset -1px 0 0 rgba(0,0,0,.1);
	          box-shadow: inset 1px 0 0 rgba(0,0,0,.1), inset -1px 0 0 rgba(0,0,0,.1);
	}
	/* Chevrons */
	.side-nav .icon-chevron-right {
	  float: right;
	  margin-top: 2px;
	  margin-right: -6px;
	  opacity: .25;
	}
	.side-nav > li > a:hover {
	  background-color: #f5f5f5;
	}
	.side-nav a:hover .icon-chevron-right {
	  opacity: .5;
	}
	.side-nav .active .icon-chevron-right,
	.side-nav .active a:hover .icon-chevron-right {
	  background-image: url(..public/img/glyphicons-halflings-white.png);
	  opacity: 1;
	}
	.side-nav.affix {
	  top: 40px;
	}
	.side-nav.affix-bottom {
	  position: absolute;
	  top: auto;
	  bottom: 270px;
	}

	/*special*/
	#tagsDiv{
		margin-bottom: 10px;
	}
	#tagList{
		/*display: inline-block;*/
		display: inline;
	}
	#otherQuestionDiv{
		display: none;
	}
</style>
{%endblock%}

{%block content%}
<div class="container">
	<h3>Members</h3>

	<div class="container-fluid" style="padding-left:0px;">
		<div class="row-fluid">
			<div class="span3">
  				<!--Sidebar content-->
  				<ul class="nav nav-list side-nav">
  					<li class="active">
  						<a href="javascript:void(0);">
  							<span class="group-name">All</span>
  							<span class="group-size">(45)</span>
  							<i class="icon-chevron-right"></i>
  						</a>
  					</li>
  					<li>
  						<a href="javascript:void(0);">
  							<span class="group-name">Board</span>
  							<span class="group-size">(9)</span>
  							<i class="icon-chevron-right"></i>
  						</a>
  					</li>
  					<li>
  						<a href="javascript:void(0);">
  							<span class="group-name">Market Department</span>
  							<span class="group-size">(16)</span>
  							<i class="icon-chevron-right"></i>
  						</a>
  					</li>
  					<li>
  						<a href="javascript:void(0);">
  							<span class="group-name">Research &amp; Development</span>
  							<span class="group-size">(20)</span>
  							<i class="icon-chevron-right"></i>
  						</a>
  					</li>
  				</ul>

  				<div class="row-fluid new-item-row">
  					<a href="javascript:void(0);">&plus;&nbsp;Create new group</a>
  				</div>
			</div>





			<div class="span9">
  				<!--Body content-->
  				<!-- tags??? -->
  				<div class="row-fluid" id="tagsDiv">
  					<span>Tags:</span>
  					<ul class="inline" id="tagList">
  						<li><a class="tag">Manager</a></li>
  						<li><a class="tag tag-selected">Chief Officer</a></li>
  						<li><a class="tag tag-selected">Engineer</a></li>
  						<li><a class="tag">Kubility</a></li>
  						<!-- the same -->
  						<li><a class="tag">Manager</a></li>
  						<li><a class="tag">Chief Officer</a></li>
  						<li><a class="tag">Engineer</a></li>
  						<li><a class="tag">Kubility</a></li>
  						<li><a class="tag">Manager</a></li>
  						<li><a class="tag">Chief Officer</a></li>
  						<li><a class="tag">Engineer</a></li>
  						<li><a class="tag">Kubility</a></li>
  						<!-- the same ends -->
  					</ul>
  				</div>



  				<table class="table table-striped table-bordered table-hover" id="meetingTable">
					<thead>
						<tr role="row">
							<th>Name</th>
							<th>Gender</th>
							<th>ID Card</th>
							<th>Phone</th>
							<th>Email</th>
							<th>Tags</th>
							<th>OP</th>
						</tr>
					</thead>
					<tbody>
						{% for role in memberAll %}
						<tr class="odd">
							<td><a href="javascript:void(0);">{{ role.name }}</a></td>
							<td>{{ role.sex }}</td>
							<td>{{ role.idcard }}</td>
							<td>{{ role.phone }}</td>
							<td>{{ role.email }}</td>
							<td>
								Manager, Engineer
							</td>
							<td>
								<a href="" class="">
									<i class="icon-edit icon-green"></i>
								</a>
								<a href="" class="">
									<i class="icon-trash icon-red"></i>
								</a>
							</td>
						</tr>
						{% endfor %}
					</tbody>
				</table>



				<div class="row-fluid new-item-row">
					<a href="#inviteModal" data-toggle="modal">&plus;&nbsp;Invite new member</a>
				</div>
				<!-- temp -->
				<div class="row-fluid new-item-row">
					<a href="#editModal" data-toggle="modal">Edit member test</a>
				</div>
				<!-- temp ends -->
				<div class="row-fluid pagination-row">
					<div class="pagination">
					  <ul>
					    <li class="prev disabled"><a href="javascript:void(0);">← Previous</a></li>
					    <li class="active"><a href="javascript:void(0);">1</a></li>
					    <li><a href="javascript:void(0);">2</a></li>
					    <li><a href="javascript:void(0);">3</a></li>
					    <li><a href="javascript:void(0);">4</a></li>
					    <li><a href="javascript:void(0);">5</a></li>
					    <li class="next"><a href="javascript:void(0);">Next → </a></li>
					  </ul>
					</div>
				</div>
			</div>

		</div>
	</div>

</div>







<!-- Popup Modal -->
<!-- Invite new member block -->
<div class="modal hide fade" id="inviteModal" role="dialog" aria-labelledby="inviteModalLabel" aria-hidden="true">
	<div class="modal-header">
		<!-- <input type="button" class="close" data-dismiss="modal" aria-hidden="true" value="x" /> -->
		<a href="javascript:void(0);" class="close" role="button" data-dismiss="modal" aria-hidden="true">x</a>
		<h3 id="inviteModalLabel">Invite new member</h3>
	</div>
	<div class="modal-body">
		<form class="form-horizontal">
			<div class="control-group">
				<label class="control-label" for="inputName">Name</label>
				<div class="controls">
					<input type="text" id="inputName" placeholder="Name" />
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="inputIDno">ID Card Number</label>
				<div class="controls">
					<input type="text" id="inputIDno" placeholder="ID Card Number" />
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="inputPhone">Phone</label>
				<div class="controls">
					<input type="text" id="inputPhone" placeholder="Phone" />
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="inputMail">Mail</label>
				<div class="controls">
					<input type="text" id="inputMail" placeholder="Mail" />
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">Validation method</label>
				<div class="controls">
					<label class="checkbox">
						<div class="checker">
							<span>
								<input type="checkbox" id="checkName" value="1" />
							</span>
						</div>
						Name
					</label>
					<label class="checkbox">
						<div class="checker">
							<span>
								<input type="checkbox" id="checkIDno" value="2" />
							</span>
						</div>
						ID Card Number
					</label>
					<label class="checkbox">
						<div class="checker">
							<span>
								<input type="checkbox" id="checkOther" value="3" />
							</span>
						</div>
						Other questions
					</label>
				</div>
			</div>
			<!-- Validation method of other question -->
			<div id="otherQuestionDiv">
				<div class="control-group">
					<label class="control-label" for="inputQuestion">Question</label>
					<div class="controls">
						<input type="text" id="inputQuestion" placeholder="Question" />
					</div>
				</div>
				<div class="control-group">
					<label class="control-label" for="inputAnswer">Answer</label>
					<div class="controls">
						<input type="text" id="inputAnswer" placeholder="Answer" />
					</div>
				</div>
			</div>
			
		</form>
	</div>
	<div class="modal-footer">
		<input type="button" class="btn btn-primary" id="inviteModalOk" value="Send invitation" />
		<input type="button" class="btn" data-dismiss="modal" aria-hidden="true" value="Cancel" />
	</div>
</div>







<!-- Edit member block -->
<div class="modal hide fade" id="editModal" role="dialog" aria-labelledby="editModalLabel" aria-hidden="true">
	<div class="modal-header">
		<!-- <input type="button" class="close" data-dismiss="modal" aria-hidden="true" value="x" /> -->
		<a href="javascript:void(0);" class="close" role="button" data-dismiss="modal" aria-hidden="true">x</a>
		<h3 id="editModalLabel">Edit member</h3>
	</div>
	<div class="modal-body">
		<form class="form-horizontal">
			<div class="control-group">
				<label class="control-label" for="eidtName">Name</label>
				<div class="controls">
					<input type="text" id="eidtName" placeholder="Name" />
				</div>
			</div>
			<div class="control-group">
				<label class="control-label">Gender</label>
				<div class="controls">
					<label class="radio inline">
						<div class="radio">
							<span class="checked">
								<input type="radio" id="radioMale" value="1" />
							</span>
						</div>
						Male
					</label>
					<label class="radio inline">
						<div class="radio">
							<span>
								<input type="radio" id="radioFemale" value="2" />
							</span>
						</div>
						Female
					</label>
					<label class="radio inline">
						<div class="radio">
							<span>
								<input type="radio" id="radioUnknown" value="-1" />
							</span>
						</div>
						Unknown
					</label>
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="eidtIDno">ID Card Number</label>
				<div class="controls">
					<input type="text" id="eidtIDno" placeholder="ID Card Number" />
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="eidtPhone">Phone</label>
				<div class="controls">
					<input type="text" id="eidtPhone" placeholder="Phone" />
				</div>
			</div>
			<div class="control-group">
				<label class="control-label" for="eidtEmail">Email</label>
				<div class="controls">
					<input type="text" id="eidtEmail" placeholder="Email" />
				</div>
			</div>



			<div class="control-group">
				<label class="control-label">Groups Belonged To</label>
				<div class="controls">
					<!-- read from DB -->
					<label class="checkbox">
						<div class="checker">
							<span>
								<input type="checkbox" id="" value="groupId1" />
							</span>
						</div>
						Board
					</label>
					<label class="checkbox">
						<div class="checker">
							<span>
								<input type="checkbox" id="" value="groupId1" />
							</span>
						</div>
						Market Department
					</label>
					<label class="checkbox">
						<div class="checker">
							<span>
								<input type="checkbox" id="" value="groupId1" />
							</span>
						</div>
						Research &amp; Development
					</label>
					<div id="dynGroups">
						<!-- add dynamically by js -->
					</div>
					<!-- groups checkbox ends -->

					<!-- dynamically add groups -->
					<div class="row-fluid">
						<a href="javascript:void(0);" id="dynAddGroup">&plus;&nbsp;Add new group</a>
					</div>
					<div class="row-fluid hide" id="dynAddGroupDiv">
						<input type="text" id="dynNewGroupName" />
						<a href="javascript:void(0);" id="dynAddGroupOk"><i class="icon-ok"></i></a>
						<a href="javascript:void(0);" id="dynAddGroupCancel"><i class="icon-remove-sign"></i></a>
					</div>
					<div class="row-fluid hide" id="dynAddGroupErr">
						<!-- add message dynamically by js -->
					</div>
					<!-- ??? -->
				</div>
			</div>



			<div class="control-group">
				<label class="control-label">Tags</label>
				<div class="controls">
					<!-- <div>Chief Officer, Consultant, Detective, Editor</div> -->
					<select id="tagSect" multiple="multiple" data-rel="chosen" >
						<option>Chief Officer</option>
						<option selected="selected">Consultant</option>
						<option>Detective</option>
						<option selected="selected">Editor</option>
					</select>

					<!-- dynamically add tags -->
					<div class="row-fluid">
						<a href="javascript:void(0);" id="dynAddTag">&plus;&nbsp;Add new tag</a>
					</div>
					<div class="row-fluid hide" id="dynAddTagDiv">
						<input type="text" id="dynNewTagName" />
						<a href="javascript:void(0);" id="dynAddTagOk"><i class="icon-ok"></i></a>
						<a href="javascript:void(0);" id="dynAddTagCancel"><i class="icon-remove-sign"></i></a>
					</div>
					<!-- ??? -->
				</div>
			</div>

		</form>
	</div>
	<div class="modal-footer">
		<input type="button" class="btn btn-primary" id="editModalOk" value="Save changes" />
		<input type="button" class="btn" data-dismiss="modal" aria-hidden="true" value="Cancel" />
	</div>
</div>





{%endblock%}





{%block morestatic%}
<!-- <script src="../public/js/jquery.uniform.min.js"></script> -->
<script src="../public/js/uniform.default.js"></script>
<!-- <script src="../public/js/jquery.chosen.min.js"></script> -->
<script src="../public/js/jquery.chosen.js"></script>

<!-- 初始化js -->
<script type="text/javascript">
$(function() {
	//chosen - improved selector
	$('[data-rel="chosen"],[rel="chosen"]').chosen();

});
</script>



<!-- 事件绑定js -->
<script type="text/javascript">
$(function() {

	// ====================================
	// tooltips
	// ====================================
	// tooltip for tags omited
    $(document).tooltip({
        selector: "a[data-toggle=tooltip]"
    });
    $(document).tooltip();

    // tooltip patch
    $("a[data-toggle=tooltip]").click(function(){
    	$(this).tooltip("toggle");
    });
    $("a[data-toggle=tooltip]").mouseleave(function(){
    	$(this).tooltip("hide");
    });
    // ====================================



	// ====================================
	// tags
	// ====================================
	// tag toggle class
	$("a.tag").click(function(){
		if($(this).hasClass("tag-selected"))
		{
			$(this).removeClass("tag-selected");
		}
		else
		{
			$(this).addClass("tag-selected");
		}
	});
	// ====================================



	// ====================================
	// invite member modal
	// ====================================
	// toggle
	$("#checkOther").change(function(){
		$("#otherQuestionDiv").toggle("fast");
	});
	// ====================================



	// ====================================
	// edit member modal
	// ====================================
	// add new group
	$("#dynAddGroup").click(function(){
		$("#dynAddGroupDiv").toggle("fast");
	});
	$("#dynAddGroupOk").click(function(){
		var newGroupName = $("#dynNewGroupName").val();
		newGroupName = newGroupName.trim();

		// validation
		// should use Reg search
		if(newGroupName.indexOf(",") > 0 || newGroupName.indexOf("，") > 0)
		{
			// error message
			$("#dynAddGroupErr").text("Cannot contain punctuation");
			$("#dynAddGroupErr").show();
			return false;
		}
		if(!(newGroupName.length > 0 && newGroupName.length <= 20))
		{
			// error message
			$("#dynAddGroupErr").text("Should be less than 20 characters");
			$("#dynAddGroupErr").show();
			return false;
		}
		// ......

		// append element
		$("#dynGroups").append(
			"<label class=\"checkbox\">" + 
				"<div class=\"checker\">" + 
					"<span class=\"checked\">" + 
						"<input type=\"checkbox\" id=\"\" value=\"newGroupId\" />" + 
					"</span>" + 
				"</div>" + 
				newGroupName + 
			"</label>");

		// bind event for new element
		$("#dynGroups").children("label.checkbox").last().find("div.checker input").bind("click", checkerClickFunc);

		// clear and hide
		$("#dynNewGroupName").val("");
		$("#dynAddGroupDiv").hide("fast");
		$("#dynAddGroupErr").hide();

	});
	$("#dynAddGroupCancel").click(function(){
		$("#dynAddGroupDiv").hide("fast");
		$("#dynAddGroupErr").hide();
	});


	// patched function for chosen selector
	var searchChoiceCloseFunc = function(){
		var index = $(this).attr("rel");
		$(this).parent("li").hide();  //still a little bug if hiden directly rather than removed
		$("#tagSect_chzn_o_" + index).removeClass("result-selected").addClass("active-result");

		//sync option in selector
		$("#tagSect option:eq(" + index + ")").removeAttr("selected");
	};

	var searchResultClickFunc = function(){
		var selfId = $(this).attr("id");
		var index = selfId.substring(selfId.lastIndexOf("_")+1, selfId.length);
		$("#tagSect_chzn_c_" + index).show();
		$("#tagSect_chzn_o_" + index).removeClass("active-result").addClass("result-selected");

		//patch
		// $("#tagSect_chzn").find(".chzn-drop").css("left", "-9000px");  //problem
		//sync option in selector
		$("#tagSect option:eq(" + index + ")").attr("selected","selected");
	};

	// add new tag
	$("#dynAddTag").click(function(){
		$("#dynAddTagDiv").toggle("fast");
	});
	$("#dynAddTagOk").click(function(){
		var newTagName = $("#dynNewTagName").val();
		newTagName = newTagName.trim();

		// validation
		// should use Reg search
		/*if(newTagName.indexOf(",") > 0 || newTagName.indexOf("，") > 0)
		{
			return false;
		}*/
		/*if(newTagName.length() > 0 && newTagName.length() <= 30)
		{
			// error message
			return false;
		}*/
		// ......

		// append element
		$("#tagSect").append("<option selected=\"selected\">" + newTagName + "</option>");
		var tagSectIndex = $("#tagSect option").length - 1;

		// $("#tagSect_chzn").remove();
		// $("#tagSect").chosen();
		// $('[data-rel="chosen"],[rel="chosen"]').chosen();

		$("#tagSect_chzn").find("ul.chzn-choices").find(".search-field").
			before("<li class=\"search-choice\" id=\"tagSect_chzn_c_" + tagSectIndex + "\">" + 
						"<span>" + newTagName + "</span>" + 
						"<a href=\"javascript:void(0);\" class=\"search-choice-close\" rel=\"" + tagSectIndex + "\"></a>" + 
					"</li>");

		$("#tagSect_chzn").find("ul.chzn-results").
			append("<li id=\"tagSect_chzn_o_" + tagSectIndex + "\" class=\"result-selected\">" + newTagName + "</li>");

		// bind event for new element
		$("#tagSect_chzn_c_" + tagSectIndex).find(".search-choice-close").click(searchChoiceCloseFunc);
		$("#tagSect_chzn_o_" + tagSectIndex).click(searchResultClickFunc);

		// clear and hide
		$("#dynNewTagName").val("");
		$("#dynAddTagDiv").hide("fast");

	});
	$("#dynAddTagCancel").click(function(){
		$("#dynAddTagDiv").hide("fast");
	});
	

	// edit member submit
	$("#editModalOk").click(function(){
		alert($("#tagSect option:selected").length);

	});
	// ====================================
	





});
</script>



<!-- 表单验证js -->
<script type="text/javascript">
	
</script>
{%endblock%}


