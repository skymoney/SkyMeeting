{% extends 'base.html'%}

{%block title%}SkyMeeting{%endblock%}

{%block cssfile%}
<style type="text/css">
    /*override bootstrap css*/
    /*.dl-horizontal dt, .dl-horizontal dd{
    	margin-top: 12px;
    }
    .dl-horizontal dt:first-child, .dl-horizontal dd:first-child{
    	margin-top: 0px;
    }*/
    .dl-horizontal dd{
    	margin-bottom: 12px;
    }
    .dl-horizontal dd:last-child{
    	margin-bottom: 0px;
    }
    #imageDt{
    	margin-top: 20px;
    }
    #imageDd span{
    	display: inline-block;
    }

    /*special*/
    .meeting-block{
		margin-bottom: 10px;
	}
	.meeting-block-header{
		border-bottom: 1px dashed #ccc;
	}
	.meeting-block-content{
		padding-top: 20px;
		padding-bottom: 10px;
	}
    #meetingTitle{
    	display: inline-block;
    	padding: 0px 50px;
    	border-bottom: 1px solid #ccc;
    }
    #meetingSubTitle{
    	margin: 10px 0px;
    	color: #0088cc;
    	font-size: 16px;
    }

    #personList li{
    	margin-left: 8px;
    	margin-right: 8px;
    	width: 120px;
    }
	.person-name{
		text-align: center;
	}
	.person-position{
		text-align: center;
	}
	img.person-head{
		padding-top: 6px;
	}
    #fileList li{
    	margin-left: 8px;
    	margin-right: 8px;
    	/*width: 200px;*/
    }
    .file-name{
    	display: inline-block;
    }
    img.file-image{

    }

    /*copied from collshell.cn*/
    /* comment START */
	#commentListDiv {
		
	}
	#commentListDiv ol, 
	#commentListDiv li {
		list-style:none;
	}
	#commentList {
		padding-bottom:5px;
	}
	#commentList .comment, 
	#commentList .messagebox {
		margin-top:15px;
	}
	.comment .author {
		float:left;
		width:81px;
		text-align:center;
	}
	.comment .pic {
		background:url(../public/img/commentpoint.png) 100% 33% no-repeat;
		padding-right:12px;
		margin-top:10px;
	}
	.comment .name {
		width:67px;
		padding-right:12px;
		font-weight:bold;
		overflow:hidden;
	}
	.comment .avatar {
		padding:1px;
		border:1px solid #999;
	}
	.comment .info {
		background:#EDEFF0 url(../public/img/comment.gif) 0 0 no-repeat;
		float:left;
		padding:10px 15px 0;
		/*width:494px;*/
		width:545px;
	}
	.comment .date {
		float:left;
		font-size:10px;
	}
	.comment .act {
		float:right;
		font-size:10px;
	}
	.comment .content {
		background:url(../public/img/comment.gif) 100% 100% no-repeat;
		margin:0 -15px;
		padding:10px 15px;
		line-height:145%;
	}
	.comment .content p {
		margin-top:10px;
	}
	.comment .content blockquote p {
		margin-top:0;
		margin-bottom:10px;
	}

	#commentPostDiv{
		/*width: 600px;*/
		margin-left: 106px;
	}
	#commentPostForm{
		width: 577px;
	}
	#inputComment{
		width: 562px;
	}
	/* comment END */
</style>
{%endblock%}

{%block content%}
<div class="container">

	<!-- Meeting title -->
	<div class="row-fluid align-center">
		<div id="meetingTitle">
			<h3>XXX Board Meeting 2013</h3>
		</div>
		<div id="meetingSubTitle">
			<span class="time">2013-03-30 15:00</span>
			<span class="place">Online</span>
		</div>
	</div>





	<!-- Basic info block -->
	<div class="row-fluid meeting-block">
		<div class="meeting-block-header">
			<h4>Basic info</h4>
		</div>
		<div class="meeting-block-content">
			<dl class="dl-horizontal">
				<dt id="imageDt">organizer</dt>
			  	<dd id="imageDd">
					<span><img class="" src="../public/img/head_64x64.png" /></span>
					<span>Jia Liu</span>
				</dd>
			  	<dt>Meeting type</dt>
			  	<dd>Board meeting</dd>
			  	<dt>Contact tel</dt>
			  	<dd>15298387338</dd>
			  	<dt>Contact mail</dt>
			  	<dd>danislyn@gmail.com</dd>
			  	<dt>Additional info</dt>
			  	<dd>important important important important important important important important important important important important important important important important important important important important important important important important important important important important important important important important </dd>
			</dl>
		</div>
	</div>





	<!-- Detail info block -->
	<div class="row-fluid meeting-block">
		<div class="meeting-block-header">
			<h4>Detail info</h4>
		</div>
		<div class="meeting-block-content">
			<p style="padding:0px 16px;">Abstract Tag recommendation encourages users to add more tags in bridging the semantic gap between human concept  the features of media object, which provides a feasible solution for content-based multimedia information retrieval. In this paper, we study personalized tag recommendation in a popular online photo sharing site | Flickr. Social relationship information of users is collected to generate an online social network. From the perspective of network topology, we propose node topological potential to characterize user's social in°uence. With this metric, we distinguish di®erent social relations between users and ¯nd out those who really have in°uence on the target users. Tag recommendations are based on tagging history and the latent personalized preference learned from those who have most in°uence in user's social network. We evaluate our method on large scale real-world data. The experimental results demonstrate that our method can outperform the non-personalized global co-occurrence method and other two state-of-the-art personalized approaches using social networks. We also analyze the further usage of our approach for the cold-start problem of tag recommendation.<br/>
			Keywords recommendation system, social tagging, personalization, social network, Flickr</p>
			<!-- 富文本html or 格式化树状文本??? -->
		</div>
	</div>





	<!-- Participant block -->
	<div class="row-fluid">
		<div class="meeting-block-header">
			<h4>Participants</h4>
		</div>
		<div class="meeting-block-content">
			<ul class="thumbnails" id="personList">
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man1_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Boss</div>
						</div>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man3_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Manager Assistant</div>
						</div>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man4_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Engineer</div>
						</div>
					</div>
				</li>
				<!-- the same -->
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man3_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Manager Assistant</div>
						</div>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man4_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Engineer</div>
						</div>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man3_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Manager Assistant</div>
						</div>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man4_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Engineer</div>
						</div>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man3_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Manager Assistant</div>
						</div>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man4_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Engineer</div>
						</div>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man3_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Manager Assistant</div>
						</div>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man4_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Engineer</div>
						</div>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man3_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Manager Assistant</div>
						</div>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<img class="person-head" src="../public/img/man4_64x64.png" />
						<div class="caption">
							<div class="person-name">Jia Liu</div>
							<div class="person-position">Engineer</div>
						</div>
					</div>
				</li>
				<!-- the same ends -->
			</ul>
		</div>
	</div>





	<!-- Attachment block -->
	<div class="row-fluid">
		<div class="meeting-block-header">
			<h4>Attachments</h4>
		</div>
		<div class="meeting-block-content">
			<ul class="thumbnails" id="fileList">
				<li class="">
					<div class="thumbnail">
						<a href="javascript:void(0);" class="image-link">
							<img class="file-image" src="../public/img/file_pdf_48x48.png" />
						</a>
						<a href="javascript:void(0);" class="default-link">
							<div class="file-name">important file1.pdf</div>
						</a>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<a href="javascript:void(0);" class="image-link">
							<img class="file-image" src="../public/img/file_doc_48x48.png" />
						</a>
						<a href="javascript:void(0);" class="default-link">
							<div class="file-name">important important important important important file2.doc</div>
						</a>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<a href="javascript:void(0);" class="image-link">
							<img class="file-image" src="../public/img/file_pic_48x48.png" />
						</a>
						<a href="javascript:void(0);" class="default-link">
							<div class="file-name">important important file3.jpg</div>
						</a>
					</div>
				</li>
				<!-- the same -->
				<li class="">
					<div class="thumbnail">
						<a href="javascript:void(0);" class="image-link">
							<img class="file-image" src="../public/img/file_doc_48x48.png" />
						</a>
						<a href="javascript:void(0);" class="default-link">
							<div class="file-name">important important important important important file2.doc</div>
						</a>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<a href="javascript:void(0);" class="image-link">
							<img class="file-image" src="../public/img/file_pic_48x48.png" />
						</a>
						<a href="javascript:void(0);" class="default-link">
							<div class="file-name">important important file3.jpg</div>
						</a>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<a href="javascript:void(0);" class="image-link">
							<img class="file-image" src="../public/img/file_doc_48x48.png" />
						</a>
						<a href="javascript:void(0);" class="default-link">
							<div class="file-name">important important important important important file2.doc</div>
						</a>
					</div>
				</li>
				<li class="">
					<div class="thumbnail">
						<a href="javascript:void(0);" class="image-link">
							<img class="file-image" src="../public/img/file_pic_48x48.png" />
						</a>
						<a href="javascript:void(0);" class="default-link">
							<div class="file-name">important important file3.jpg</div>
						</a>
					</div>
				</li>
				<!-- the same ends -->
			</ul>
		</div>
	</div>





	<!-- Comment block -->
	<div class="row-fluid">
		<div class="meeting-block-header">
			<h4>Comments</h4>
		</div>
		<div class="meeting-block-content">
			<div id="commentListDiv">
				<!-- comments START -->
				<ol id="commentList">
					<!-- for each -->
					<li class="comment">
						<div class="author">
							<div class="pic">
								<img src='../public/img/head2_48x48.png' class='img-polaroid' />
							</div>
							<div class="name">
								<a href="javascript:void(0);">
									Danis Lu
								</a>
							</div>
						</div>
						<div class="info">
							<div class="date">
								2013年3月11日09:06
								&nbsp;|&nbsp;
								<a>#<span class="floor-number">1</span></a>
							</div>
							<div class="act">
								<a href="javascript:void(0);" class="reply">回复</a>
							</div>
							<div class="clearfix"></div>
							<div class="content">
								你好，读了你的这篇文章，说出了很多我心里的话，有很多感触。可否授权我在我的博客上转载一下？
							</div>
						</div>
						<input type="hidden" data-comment-id="111" data-author-id="1" data-author-name="Danis Lu" data-floor-no="2" />
						<div class="clearfix"></div>
					</li>
					<li class="comment">
						<div class="author">
							<div class="pic">
								<img src='../public/img/head2_48x48.png' class='img-polaroid' />
							</div>
							<div class="name">
								<a href="javascript:void(0);">
									Danis LuLuLuLuLu
								</a>
							</div>
						</div>
						<div class="info">
							<div class="date">
								2013年3月11日09:06
								&nbsp;|&nbsp;
								<a>#<span class="floor-number">2</span></a>
							</div>
							<div class="act">
								<a href="javascript:void(0);" class="reply">回复</a>
							</div>
							<div class="clearfix"></div>
							<div class="content">
								读了你的这篇文章，说出了很多我心里的话，有很多感触。
							</div>
						</div>
						<input type="hidden" data-comment-id="112" data-author-id="2" data-author-name="Danis LuLuLuLuLu" data-floor-no="2" />
						<div class="clearfix"></div>
					</li>

					<!-- <br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/><br/> -->
				</ol>
				<!-- comments END -->
			</div>



			<!-- comment post -->
			<div id="commentPostDiv">

				<form id="commentPostForm">
					<div class="row-fluid">
						<textarea id="inputComment" rows="3" placeholder="Add comment"></textarea>
						<input type="hidden" id="replyToData" data-comment-id="" data-author-id="" data-author-name="" />
					</div>
					<div class="row-fluid align-right">
						<input type="button" class="btn btn-primary btn-small" id="addCommentOk" value="提交" />
					</div>
				</form>
			</div>
		</div>
	</div>


	<input type="hidden" id="meetingData" data-meeting-id="10086" />


</div>
{%endblock%}





{%block morestatic%}
<!-- lib for scroll plugin -->
<script src="../public/js/jquery.scrollTo.min.js"></script>



<!-- 事件绑定js -->
<script type="text/javascript">
/* extend functions */
$.fn.setCursorPosition = function(position) {
    if(this.length == 0) return this;
    return $(this).setSelection(position, position);
}
$.fn.setSelection = function(selectionStart, selectionEnd) {
    if(this.length == 0) return this;
    input = this[0];

    if (input.createTextRange) {
        var range = input.createTextRange();
        range.collapse(true);
        range.moveEnd('character', selectionEnd);
        range.moveStart('character', selectionStart);
        range.select();
    } else if (input.setSelectionRange) {
        input.focus();
        input.setSelectionRange(selectionStart, selectionEnd);
    }

    return this;
}
$.fn.focusEnd = function() {
    this.setCursorPosition(this.val().length);
}



$(function() {
	// constants
	var TEXT_REPLY = "回复";
	var TEXT_REPLY_SEPERATOR = ": ";

	var AJAX_IDLE = 0;
	var AJAX_BUSY = 0;

	// ajax flags
	var ajaxAddCommentFlag = AJAX_IDLE;



	var replyClickFunc = function(){
		var dataElement = $(this).parents("li.comment").find("input[type='hidden']");
		var commentId = dataElement.attr("data-comment-id");
		var authorId = dataElement.attr("data-author-id");
		var authorName = dataElement.attr("data-author-name");

		$("#replyToData").attr("data-comment-id", commentId);
		$("#replyToData").attr("data-author-id", authorId);
		$("#replyToData").attr("data-author-name", authorName);

		// 简单粗暴!!!
		$("#inputComment").val(TEXT_REPLY + authorName + TEXT_REPLY_SEPERATOR);

		$("#inputComment").focusEnd();
		$.scrollTo("#inputComment");
		// $.scrollTo( '#inputComment', 800, {easing:'elasout'} );
		// !!!
	};
	$("a.reply").click(replyClickFunc);


	$("#addCommentOk").click(function(){
		var meetingId = $("#meetingData").attr("data-meeting-id");
		// meetingId被改怎么破???
		if(meetingId.length == 0)
		{
			return false;
		}

		var content = $("#inputComment").val();
		content = content.trim();
		
		// validation
		// too young too simple, what if injected code???
		if(!(content.length > 0 && content.length < 1000))
		{
			// error message
			return false;
		}


		var replyToCommentId = $("#replyToData").attr("data-comment-id");
		var replyToAuthorId = $("#replyToData").attr("data-author-id");
		var replyToAuthorName = $("#replyToData").attr("data-author-name");

		// check reply content
		if(content.indexOf(TEXT_REPLY + replyToAuthorName) != 0)
		{
			// reset empty
			replyToCommentId = "";
			replyToAuthorId = "";
			replyToAuthorName = "";
		}
		

		// ajax flag
		if(ajaxAddCommentFlag == AJAX_IDLE)
		{
			// set ajax flag
			ajaxAddCommentFlag = AJAX_BUSY;

			// ajax submit
			$.post(
				"/meeting/addcomment/",
				{
					"meetingId": meetingId,
					"content": content,
					"replyToUser": replyToAuthorId,
					"replyToComment": replyToCommentId
				},
				function(data)
				{
					var result = eval("(" + data + ")");
					if(result.success == "true")
					{
						var currentFloor = $("#commentList").children("li").last().find(".floor-number").text();
						alert(currentFloor);
						
					}
					else
					{
						// error message
					}

					// reset ajax flag
					ajaxAddCommentFlag = AJAX_IDLE;
				}
			);
		}

	});

});
</script>

<!-- 表单验证js -->
<script type="text/javascript">
	
</script>
{%endblock%}


